pico-8 cartridge // http://www.pico-8.com
version 16
__lua__


-- to do: stars on background, collisions, off-screen indicators

function draw_phobos()
	spr(2, phobos.x, phobos.y)
end

function draw_demos()
	spr(4, demos.x, demos.y)
end

function draw_luna()
	spr(1, luna.x, luna.y)
end

function draw_target(x,y)
	circfill(x,y,4,8)
	circfill(x,y,3,7)
	circfill(x,y,2,8)
	circfill(x,y,1,7)
end

blank_timer_max=600
blank_timer=blank_timer_max

function _init()
	cls()
end

-->8
--functions

phobos = {
	x=rnd(63) + 63,
	y=rnd(63),
	m=30,
	vx=rnd(0.2),
	vy=rnd(1.0)+0.2,
	f=0
}


demos = {
	x=rnd(63),
	y=rnd(63) + 63,
	m=30,
	vx=-1 * phobos.vx,
	vy=-1 * phobos.vy,
	f=0
}

luna = {
	x=rnd(20),
	y=rnd(20),
	m=30,
	vx=0,
	vy=0,
	f=0
}

target = {
	x=rnd(57)+70,
	y=rnd(57)+70
}


function move_planet(p)
	
	if p.f >= 2 then
		
	else

 	for f in all(planets) do
 		local dist=0
 		local angle=0
 		local force=0
 		
 		if not(f==p) then
 			dist=pythag(f.x-p.x,f.y-p.y)
 			dist = mid(0.01, dist, 50)
 			angle = atan2(p.x-f.x,p.y-f.y)
 			force = (p.m * f.m * (6.67*10^-3)) / dist^2
 			force = mid(0.01, force, 2)
 			p.f = max(force, p.f)
 			p.vx=p.vx-force*cos(angle)
 			p.vy=p.vy-force*sin(angle)
 		end
 	end
 	
 	p.vx = mid(-6, p.vx, 6)
 	p.vy = mid(-6, p.vy, 6)
 
 	--move
 	p.x+=p.vx -- (sx - 63)
 	p.y+=p.vy -- (sy - 63)
 	
 end
end

function pythag(a,b)
	if a > 126 then a = 126 end
	if b > 126 then b = 126 end
	return sqrt(a^2+b^2)
end


-->8
--draw

function _draw()
	--comment out for trails
	cls()
	
	draw_phobos()
	draw_demos()
	draw_luna()
	draw_target(target.x, target.y)

	--print(demos.x)
	--print(demos.y)
	--print(phobos.x)
	--print(phobos.y)
	--print(target.x)
	--print(target.y)
	--print(dist)
	--print(angle)
	--print(force)
	print(phobos.f)
	print(demos.f)
	print(luna.f)
	

	
end


-->8
--update

function _update60()
	
	blank_timer-=1
	if blank_timer<0 then 
		blank_timer=blank_timer_max 
		cls()
	end

	planets = {}
	add(planets, phobos)
	add(planets, demos)
	add(planets, luna)
	
	get_avg_change()	
	move_planet(phobos, planets)
	move_planet(demos, planets)
	move_planet(luna, planets)
	
	-- target stays in a fixed position
	--target.x -= (sx - 63)
	--target.y -= (sy - 63)

end
	
-->8

function get_avg_change()
 
	local avg_x = {}
	local avg_y = {}
	
		for p in all(planets) do
		add(avg_x, p.x)
		add(avg_y, p.y)
	end
	
	sx = 0.0
	sy = 0.0
	for i=1,#avg_x do
		sx += avg_x[i]
		sy += avg_y[i]
	end
	sx = sx / #avg_x
	sy = sy / #avg_y
end

__gfx__
0000000000550000000ffff088888888033333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055d55500fff99ff80088008332223330070000000000700000000700000000000000070000700000070000000000000000000000000000000000000
00700700055555550ffff99f80088008332322230777000000000000000000000007000000007070000700000770000000000000000000000000000000000000
0007700055556555ff9aaa9f88888888332333330070000000700000000000000077700000700000077770000000707000000000000000000000000000000000
0007700056555d50ffaaaaff88888888323333230000000000000000000000000007000000007000007777000000070000000000000000000000000000000000
0070070055d565500faa99f080088008233223230000007000007000000000000000000000000000000700000000707000000000000000000000000000000000
0000000005d55d550ff99ff080088008333323330000077700077700000000000000000000007000000700000000000000000000000000000000000000000000
000000000555055000ffff0088888888032333300000007000007000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000022222200000000000000000000000000000000000000000090000000908888a0908888a0900888a0900088a00000000
00000000000000000000000000000000223332220000000000000000000000000000000000a00a0000a99a9088a99a9a88a99a9a88a09a900000900000000000
000000000000000000000000000000002232333200000000000000000000000000000000000a0000099909000999080a0990080a090008000900080000000000
00000000000000000000000000000000223222220000000000000000000000000007700000a77a0000a79a9000a79a8000000080000000000000000000000000
0000000000000000000000000000000023222232000000000000000000000000000770000a077a0009097a00a8097a80a8000080a80000000000000000000000
00000000000000000000000000000000322332320000000000000000000000000000000000a0000000a90990a8a90980a8a00080a80000000000000000000000
00000000000000000000000000000000222232220000000000000000000000000000000000000a0009000a09a8998898a8998898a80080980800000800000000
0000000000000000000000000000000002322220000000000000000000000000000000000000000000090000a8a8988aa8a8988aa800908a0000000a00000000
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888eeeeee888777777888eeeeee888eeeeee888888888888888888888888888888888888888888888ff8ff8888228822888222822888888822888888228888
8888ee888ee88778877788ee888ee88ee888ee88888888888888888888888888888888888888888888ff888ff888222222888222822888882282888888222888
888eee8e8ee8777787778eeeee8ee8eeeee8ee88888e88888888888888888888888888888888888888ff888ff888282282888222888888228882888888288888
888eee8e8ee8777787778eee888ee8eeee88ee8888eee8888888888888888888888888888888888888ff888ff888222222888888222888228882888822288888
888eee8e8ee8777787778eee8eeee8eeeee8ee88888e88888888888888888888888888888888888888ff888ff888822228888228222888882282888222288888
888eee888ee8777888778eee888ee8eee888ee888888888888888888888888888888888888888888888ff8ff8888828828888228222888888822888222888888
888eeeeeeee8777777778eeeeeeee8eeeeeeee888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555ddd5d5d5dd555dd5ddd5ddd55dd5dd555dd555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555d555d5d5d5d5d5555d555d55d5d5d5d5d55555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ddd5ddd5dd55d5d5d5d5d5555d555d55d5d5d5d5ddd555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555d555d5d5d5d5d5555d555d55d5d5d5d555d555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555d5555dd5d5d55dd55d55ddd5dd55d5d5dd5555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555555665666566556665666566656665666555556665655566656655666566655755575555555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556555655565656555656565655655655555556565655565656565655556557555557555555555555555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555556555665565656655665566655655665555556665655566656565665556557555557555555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556565655565656555656565655655655555556555655565656565655556557555557555555555555555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556665666565656665656565655655666566656555666565656565666556555755575555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5555ee55ee5eee5e5555555666555555775555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e5555555656577755755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555eee5e5555555666555557755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e5555555655577755755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5ee555ee5e5e5eee55555655555555775555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565655555bbb5bb55bb555755c555c5c5575555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565657775b5b5b5b5b5b57555c555c5c5557555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555556555555bb55b5b5b5b57555ccc5ccc5557555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565657775b5b5b5b5b5b57555c5c555c5557557555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565655555b5b5b5b5bbb55755ccc555c5575575555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565655555bbb5bb55bb555755c555c5c5575555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565657775b5b5b5b5b5b57555c555c5c5557555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555566655555bb55b5b5b5b57555ccc5ccc5557555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555657775b5b5b5b5b5b57555c5c555c5557557555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555566655555b5b5b5b5bbb55755ccc555c5575575555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555556655555ccc5ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5555555556555777555c5c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565555555ccc5c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565657775c555c5c55755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555566655555ccc5ccc57555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555566655555ccc555555555555555555555555555515555555555555555555555555555555555555555555555555555555555555555555555555555555
5555555556565777555c555555555555555555555555555171555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555665555555cc555555555555555555555555555177155555555555555555555555555555555555555555555555555555555555555555555555555555
5555555556565777555c557555555555555555555555555177715555555555555555555555555555555555555555555555555555555555555555555555555555
55555555565655555ccc575555555555555555555555555177771555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555177115555555555555555555555555555555555555555555555555555555555555555555555555555
55555555556655555cc55ccc55555555555555555555555511715555555555555555555555555555555555555555555555555555555555555555555555555555
555555555655577755c55c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555655555555c55c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555655577755c55c5c55755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555556655555ccc5ccc57555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656565655555bbb5bb55bb555755ccc557555555ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656565657775b5b5b5b5b5b5755555c55575555555c5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656556555555bb55b5b5b5b57555ccc555757775ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555666565657775b5b5b5b5b5b57555c55555755555c555575555555555555555555555555555555555555555555555555555555555555555555555555
555555555565565655555b5b5b5b5bbb55755ccc557555555ccc5755555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656565655555bbb5bb55bb555755c5c557555555ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656565657775b5b5b5b5b5b57555c5c55575555555c5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555656566655555bb55b5b5b5b57555ccc555757775ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
555555555666555657775b5b5b5b5b5b5755555c555755555c555575555555555555555555555555555555555555555555555555555555555555555555555555
555555555565566655555b5b5b5b5bbb5575555c557555555ccc5755555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555577555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555557555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555557755555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555557555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555577555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555bbb5bb55bb55575566656555666566556665666556655555666557555555555555555555555555555555555555555555555555555555555555555555555
55555b5b5b5b5b5b5755565656555656565656555565565555555656555755555555555555555555555555555555555555555555555555555555555555555555
55555bbb5b5b5b5b5755566656555666565656655565566655555666555755555555555555555555555555555555555555555555555555555555555555555555
55555b5b5b5b5b5b5755565556555656565656555565555655755655555755555555555555555555555555555555555555555555555555555555555555555555
55555b5b5bbb5bbb5575565556665656565656665565566557555655557555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5ee55ee555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ee55e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5eee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555556665566565656665555566656555666566556665666557556665555556656665656566656665575555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556665656565656555555565656555656565656555565575556565555565655655656565556565557555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555556565656565656655555566656555666565656655565575556665555565655655666566556655557555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556565656566656555555565556555656565656555565575556555575565655655656565556565557555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556565665556556665666565556665656565656665565557556555755566555655656566656565575555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5555ee55ee5eee5e555555566556665566566655555ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e555555565655655655556557775c5c5555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555eee5e555555565655655666556555555c5c5555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e555555565655655556556557775c5c5555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5ee555ee5e5e5eee5555566656665665556555555ccc5555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5555ee55ee5eee5e5555555666566555665655566655555ccc555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e5555555656565656555655565557775c5c555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555eee5e5555555666565656555655566555555c5c555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e5555555656565656565655565557775c5c555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5ee555ee5e5e5eee55555656565656665666566655555ccc555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5555ee55ee5eee5e5555555666556656665566566655555ccc555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555e5e5e5555555655565656565655565557775c5c555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e555eee5e5555555665565656655655566555555c5c555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
82888222822882228888822882288882828882228888888888888888888888888888888888888888888888888222822882228882822282288222822288866688
82888828828282888888882888288828828888828888888888888888888888888888888888888888888888888882882888828828828288288282888288888888
82888828828282288888882888288828822288228888888888888888888888888888888888888888888888888822882888828828822288288222822288822288
82888828828282888888882888288828828288828888888888888888888888888888888888888888888888888882882888828828828288288882828888888888
82228222828282228888822282228288822282228888888888888888888888888888888888888888888888888222822288828288822282228882822288822288
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

__map__
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000600000060000600096500b6500f65013650196501d65022650276502b6502f6503265033650346503465034650346503465032650316502e65029650226501f6501865014650126500d650096500865000600
001000000565008650000000b6500e650136501a65021650266502c650316503465037650396503a6503b650000003b6503b65038650336502d6502965023650206501c65015650106500c650086500265002650
00010000000000000005650086500c6500f65012650166501b65020650246502c65030650316500000033650346503465034650316502c650246501e650146500f6500c650086500265000000000000000000000
010800000005102051040510505107051090510b0510c0510e05110051110511305117051180511a0511c0511d0511f05121051210511f0511d0511c0511a0511805117051150511305111051100510e0510c051
__music__
00 41424344
00 01030244

